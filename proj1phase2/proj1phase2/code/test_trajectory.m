% Used for HKUST ELEC 5660

close all;
clear all;
clc;
addpath('./utils','./readonly');
    
path1 = [0.0 0.0 0.0 ; ...
         0.0 0.0 1.0 ; ...
         1.0 1.0 1.0 ; ...
         -1.0 2.3 1.0 ; ...
         1.0 3.0 1.4 ; ...
         -1.6 4.0 1.0 ; ...
         1.0 5.3 1.0 ; ...
         -1.0 6.9 1.0 ; ...
         1.0 7.1 1.0 ; ...
         -1.4 8.0 1.0 ; ...
         1.0 9.0 1.6 ;];

path2 = [0.0 0.0 0.0 ; ...
         1.0 1.0 0.0 ; ...
        -1.0 1.0 2.0 ; ...
       -1.0 -1.0 2.0 ; ...
        1.0 -1.0 2.0 ; ...
        0.0 0.0 4.0 ; ...
        3.0 2.7 4.0 ; ...
        1.0 2.0 6.0 ; ...
        0.0 0.0 6.0 ; ...
        1.0 1.0 6.0 ];

path3_a=[
         0         0         0;
    0.9625    0.9500    0.3208;
    1.9000    1.8022    0.6333;
    2.7883    2.4690    0.9294;
    3.6045    2.8816    1.2015;
    4.3272    2.9976    1.4424;
    4.9379    2.8050    1.6460;
    5.4207    2.3238    1.8069;
    5.7631    1.6034    1.9210;
    5.9563    0.7179    1.9854;
    5.9951   -0.2414    1.9984;
    5.8787   -1.1759    1.9596;
    5.6101   -1.9894    1.8700;
    5.1962   -2.5981    1.7321;
    4.6476   -2.9394    1.5492;
    3.9787   -2.9781    1.3262;
    3.2068   -2.7104    1.0689;
    2.3518   -2.1636    0.7839;
    1.4359   -1.3942    0.4786;
    0.4828   -0.4812    0.1609;
   -0.4828    0.4812    0.1609;
   -1.4359    1.3942    0.4786;
   -2.3518    2.1636    0.7839;
   -3.2068    2.7104    1.0689;
   -3.9787    2.9781    1.3262;
   -4.6476    2.9394    1.5492;
   -5.1962    2.5981    1.7321;
   -5.6101    1.9894    1.8700;
   -5.8787    1.1759    1.9596;
   -5.9951    0.2414    1.9984;
   -5.9563   -0.7179    1.9854;
   -5.7631   -1.6034    1.9210;
   -5.4207   -2.3238    1.8069;
   -4.9379   -2.8050    1.6460;
   -4.3272   -2.9976    1.4424;
   -3.6045   -2.8816    1.2015;
   -2.7883   -2.4690    0.9294;
   -1.9000   -1.8022    0.6333;
   -0.9625   -0.9500    0.3208;
   -0.0000   -0.0000    0.0000;
    ];
path4=[...
    0.0,  0.0,  0.0;   
    1.0,  3.0,  5.0;   
    4.0,  3.0,  8.2;   
    -4.0,  4.0,  1.0;   
    6.0,  -3.0,  0.5;   
    7.0,  0.0,  0.0;   
    6.0, -2.0,  1.5;   
    -4.0, -3.0,  1.0;   
    2.0, -2.0,  6.5;   
    1.0,  0.0,  1.2;   
    0.0,  0.0,  0.0    
];
% Please design 2 sets of waypoints below...
    
h1 = subplot(3,3,1);
h2 = subplot(3,3,2);
h3 = subplot(3,3,3);
h4 = subplot(3,3,4);
h5 = subplot(3,3,5);
h6 = subplot(3,3,6);
h7 = subplot(3,3,7);
h8 = subplot(3,3,8);
h9 = subplot(3,3,9);
set(gcf, 'Renderer', 'painters');
set(gcf, 'Position', [100, 100, 1400, 1000]);
% set(gcf, 'WindowStyle','Modal');


% Trajectory Generator
% trajectory_generator([], path1, h1);
trajectory_generator([], path1 ...
    , h1);

% Run Trajectory
run_trajectory_readonly(h1, h2, h3, h4, h5, h6, h7, h8, h9);

calculate_RMSE=@(a,b) sqrt(mean((a(:)-b(:)).^2));
calculate_RMSE_yaw=@(a,b) sqrt(mean(wrapToPi((a(:)-b(:))).^2));

global current_states
global desired_states
rmse_p = calculate_RMSE(current_states(:,1:3),desired_states(:,1:3));
rmse_v = calculate_RMSE(current_states(:,4:6),desired_states(:,4:6));
rmse_yaw = rad2deg(calculate_RMSE_yaw(current_states(:,7),desired_states(:,7)));

disp(['RMSE Position(m):',num2str(rmse_p)])
disp(['RMSE Velocity(m/s):',num2str(rmse_v)])
disp(['RMSE Yaw(deg):',num2str(rmse_yaw)])
